// Workdir for temporary data
projectName = 'TO_BE_SET'
date = new Date().format( 'yyyyMMdd-HHmmss')
//workDir = "$SCRATCH/wf/$date-$projectName"
workDir = "$SCRATCH/wf/$projectName"

//Type of run, set to false to stop at cutadapt step in order to defined dada2 parameters
complete = false

// Git informations of workflow
manifest {
    homePage = 'https://gitlab.ifremer.fr/bioinfo/nextflow-MB-SeBiMer'
    description = 'Workflow for NGS metabarcoding data analysis used by Ifremer/SeBiMer team'
    defaultBranch = 'master'
    author = 'Cyril NoÃ«l, Laure Quintric'
    mainScript = 'MB.nf'
    name = 'SeBiMer-MB-Workflow'
}

// Define env variable that will be accessible in nextflow tasks
/*env {
    VARENV = 'nextflow.env.VARENV'
}
*/
// Define parameters taht will be accessible in nextflow pipeline script
params {
    //qiime input parameters
    inmanifest = "/TO_BE_SET/pipeline_indir/q2_manifest"
    inmetadata = "/TO_BE_SET/nexttest/pipeline_indir/q2_metadata"
    //outdir = "/TO_BE_SET/pipeline_outdir/$date-$projectName"
    outdir = "/TO_BE_SET/nexttest/pipeline_outdir/$projectName"

    //cutadapt parameters 
    cutadapt {
        primerF = "ACGGRAGGCAGCAG"
        primerR = "TACCAGGGTATCTAATCCT"
        errorRate = "0.15"
        overlap = "13"
    }
    //dada2 parameters
    dada2 {
        trim3F = "0"
        trim3R = "0"
        trunclenF = "0"
        trunclenR = "0"
        maxee = "2"
        minqual = "20"
        chimeras = "consensus"
    }
}

// Define the executor = cluster scheduler
executor {
    name = 'pbspro'
}

// Define process selector for tasks resources
process {
    // default for all tasks
    cpus = 1
    queue = 'sequentiel'
    memory = '5GB'
    time = '00:10:00'
    //clusterOptions can be used to add some native specification to pbs pro not available in the standard parameters
    clusterOptions = '-M n'

    //cutadapt process
    withName : q2_cutadapt {
        cpus = 14
        memory = '50GB'
        queue = 'omp'   
        time = '01:00:00'
    }
    //dada2 process
    withName : q2_dada2 {
        cpus = 56
        memory = '115GB'
        queue = 'omp'   
        time = '05:00:00'
    }
    // for all tasks with the label 'omp_28_100g'
/*    withLabel: omp_28_100g {
        cpus = 28
        memory = '100GB'
        queue = 'omp'
    }*/
}

// REPORTS :
reports = "${params.outdir}/wf-reports"
// produce a report in html : report.html
report {
    enabled = true
    file = "${reports}/report.html"
}
// create a diagram of tasks
dag {
    enabled = true
    file = "${reports}/dag.svg"
}
// produce a timeline report in html : timeline.html
timeline {
    enabled = true
    file = "${reports}/timeline.html"
}

// enable trace to get a detailed report on each task trace.txt
trace {
    enabled = true
    fields = 'task_id,hash,native_id,process,name,status,exit,cpus,%cpu,disk,memory,%mem,queue,time,realtime'
    file = "${reports}/trace.txt"
    sep = '\t'
}
